<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BiteLing - Talk Practice</title>
    <link rel="icon" type="image/svg+xml" href="../assets/favicon.svg">
    <link rel="stylesheet" href="../css/talk.css">
</head>
<body>
    <div class="container">
        <!-- Top Bar -->
        <div class="top-bar">
            <button class="back-button" onclick="window.location.href='../index.html'">â† Back</button>
            <h1 class="page-title">Talk Practice ğŸ’¬</h1>
            <div class="cookies-earned">+<span id="cookiesEarned">0</span> ğŸª</div>
        </div>

        <!-- Conversation Partner Card -->
        <div class="partner-card">
            <img src="../assets/xiaobing.png" alt="Cookie" class="partner-avatar-img">
            <div class="partner-info">
                <h2>Cookie â€¢ å°é¥¼ (XiÇobÇng)</h2>
                <p>Practice speaking Chinese with your AI conversation partner!</p>
                <div class="cost-badge">Earn 5 ğŸª per conversation</div>
            </div>
        </div>

        <!-- Mode Selector -->
        <div class="mode-selector">
            <button class="mode-btn active" data-mode="chat" title="Text chat with optional voice input and audio">
                <span class="mode-icon">ğŸ’¬</span>
                <span class="mode-label">Chat with AI</span>
            </button>
            <button class="mode-btn" data-mode="call" title="Audio-only conversation mode">
                <span class="mode-icon">ğŸ“</span>
                <span class="mode-label">Call AI</span>
            </button>
            <button class="mode-btn" data-mode="partner" title="Match with a real user">
                <span class="mode-icon">ğŸ‘¥</span>
                <span class="mode-label">Find Partner</span>
            </button>
        </div>

        <!-- Partner Matching Container -->
        <div class="partner-matching-container hidden" id="partnerMatchingContainer">
            <div class="matching-card">
                <div class="matching-icon" id="matchingIcon">ğŸ”</div>
                <h2 id="matchingTitle">Find a Conversation Partner</h2>
                <p id="matchingMessage">Match with another user at your level for real conversation practice!</p>

                <div class="matching-filters">
                    <label>
                        <input type="checkbox" id="matchText" checked>
                        Text Chat
                    </label>
                    <label>
                        <input type="checkbox" id="matchVoice">
                        Voice Call
                    </label>
                </div>

                <button class="match-button" id="findMatchButton">
                    <span class="match-btn-text">Find Partner</span>
                </button>

                <div class="matching-status hidden" id="matchingStatus">
                    <div class="spinner"></div>
                    <p>Searching for a partner at HSK level <span id="matchHSKLevel">1</span>...</p>
                    <button class="cancel-match-btn" id="cancelMatchButton">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Chat Container -->
        <div class="chat-container" id="chatContainer">
            <!-- Output Mode Toggle -->
            <div class="output-controls">
                <label class="toggle-switch">
                    <input type="checkbox" id="autoPlayAudio" checked>
                    <span class="toggle-slider"></span>
                </label>
                <span class="toggle-label">Auto-play AI responses</span>
            </div>

            <div class="chat-messages" id="chatMessages">
                <div class="message ai-message">
                    <div class="message-bubble">
                        <button class="play-audio-btn" onclick="playMessageAudio(this, 'ä½ å¥½ï¼æˆ‘æ˜¯ä½ çš„ä¸­æ–‡å¯¹è¯ä¼™ä¼´ã€‚')" title="Play audio">
                            <span class="audio-icon">ğŸ”Š</span>
                        </button>
                        <div class="message-chinese">ä½ å¥½ï¼æˆ‘æ˜¯ä½ çš„ä¸­æ–‡å¯¹è¯ä¼™ä¼´ã€‚</div>
                        <div class="message-pinyin">nÇ hÇo! wÇ’ shÃ¬ nÇ de zhÅng wÃ©n duÃ¬ huÃ  huÇ’ bÃ n.</div>
                        <div class="message-english">Hello! I'm your Chinese conversation partner.</div>
                    </div>
                </div>
            </div>

            <!-- Input Area -->
            <div class="input-container">
                <button class="mic-button" id="micButton" title="Speak in Chinese">
                    <span class="mic-icon">ğŸ¤</span>
                </button>
                <input type="text"
                       id="userInput"
                       class="text-input"
                       placeholder="Type in Chinese or use voice..."
                       autocomplete="off">
                <button class="send-button" id="sendButton">
                    <span>Send</span>
                </button>
            </div>
        </div>

        <!-- Call Mode Screen -->
        <div class="call-screen hidden" id="callScreen">
            <img src="../assets/xiaobing.png" alt="Cookie" class="call-avatar-img">
            <div class="call-status" id="callStatus">Ready to call Cookie</div>
            <div class="call-timer" id="callTimer">00:00</div>

            <div class="call-transcript" id="callTranscript">
                <!-- Live transcript will appear here -->
            </div>

            <div class="call-controls">
                <button class="call-button start" id="startCallButton">
                    <span class="call-icon">ğŸ“</span>
                    <span>Start Call</span>
                </button>
                <button class="call-button end hidden" id="endCallButton">
                    <span class="call-icon">ğŸ“´</span>
                    <span>End Call</span>
                </button>
            </div>
        </div>

        <!-- Azure Notice -->
        <div class="azure-notice" id="azureNotice">
            <div class="notice-content">
                <span class="notice-icon">ğŸ”‘</span>
                <p>To enable AI conversations, add your Azure OpenAI API key in the code.</p>
                <button onclick="document.getElementById('azureNotice').style.display='none'">Got it</button>
            </div>
        </div>
    </div>

    <script src="../env-config.js" onerror="this.remove()"></script>
    <script src="../js/talk.js"></script>
</body>
</html>
